# HorrorEngineX - World Generation Guide

## Overview

HorrorEngineX включает полную систему генерации мира, которая создает напряженную, страшную атмосферу на сервере.

## World Generation Features

### 1. **Constant Rain System**
- Постоянный дождь в указанных мирах
- Создает угрюмую атмосферу
- Конфигурируемые миры в `config.yml`

```yaml
world-gen:
  constant-rain: true
  rain-worlds:
    - "world"
    - "world_nether"
```

### 2. **Haunted House Generation**
Автоматическая генерация заброшенных домов вокруг игроков:

- **Варианты размеров**:
  - Малые дома: 12x12 блоков (60% шанс)
  - Большие дома: 20x20 блоков (40% шанс)
- **Высота**: 1-6 этажей (случайная)
- **Материалы**: Темный дуб (DARK_OAK_LOG), доски (DARK_OAK_PLANKS)
- **Фичи**:
  - Окна: 2 для малых домов, 4 для больших домов на каждой стене
  - Разбитые окна (20% шанс отсутствия стекла)
  - Паутина (COBWEB): 5-8 на этаж
  - **Сундуки с записками**: Книги с жутким текстом (лор)
  - Мебель в больших домах (столы, стулья)
  - Плоская крыша
  - **Подземные входы**: Туннели 3x3 с лестницами соединяют дома с лабораториями

**Конфигурация**:
```yaml
haunted-houses: true
house-generation-chance: 0.05  # 5% вероятность
house-min-floors: 1
house-max-floors: 6  # согласно требованиям
```

### 3. **Secret Laboratory Generation**
Подземные многокомнатные лаборатории с различными секциями:

- **Размер**: 60x60x12 блоков
- **Глубина**: 15 блоков под землей
- **Структура**:
  - Центральные коридоры (главные холлы)
  - Лестница на поверхность
- **Комнаты**:
  - **Комната директора (1)**: Офисная мебель, сейф, картины, книжные полки
  - **Комнаты ученых (2-6)**: Варочные стойки, верстаки, сундуки, столы зачарования
  - **Служебные туалеты (6)**: Кварцевые стены, котлы (раковины и туалеты)
  - **Большие склады (2)**: Множество сундуков, бочек
  - **Комнаты исследований (4)**: Столы зачарования, варочные стойки, котлы, сундуки с заметками
  - **Столовые с кухнями (2)**: Столы, стулья, печки, сундуки
  - **Библиотеки (3)**: Книжные полки, столы для чтения
  - **Комната отдыха (1, редкость)**: Диваны, журбокс, растения, стол (70% шанс генерации)
- **Освещение**: Красные лампы по всей лаборатории

**Конфигурация**:
```yaml
secret-labs: true
lab-generation-chance: 0.02  # 2% вероятность
```

### 4. **Sawmill Generation**
Лесопилки с оборудованием для обработки древесины:

- **Размер**: 12x10x8 блоков
- **Материалы**: Еловые доски, дубовые бревна
- **Фичи**:
  - Пильный диск (железные решетки)
  - Резаки по камню в основании
  - Кучи бревен разных типов (дуб, ель, береза, темный дуб)
  - Верстаки для работы
  - Сундуки с инструментами
  - Кучи опилок (грубая земля)
  - Наковальня и железные блоки
  - Паутины (заброшенный вид)
  - Внешние кучи бревен
  - Забор вокруг здания

**Конфигурация**:
```yaml
sawmills: true
sawmill-generation-chance: 0.04  # 4% вероятность
```

### 5. **Cave Tunnel Networks**
Системы туннелей в подземелье:

- **Сечение туннеля**: 3x3 блока (для основного туннеля)
- **Ветки**: 2x2 блока (боковые ответвления)
- **Длина**: 100-600 блоков
- **Материалы, которые вырезаются**:
  - STONE, DEEPSLATE, GRANITE, DIORITE, ANDESITE
  - TUFF, DIRT, GRAVEL, CALCITE, BLACKSTONE
  
**Фичи**:
- Случайные ветки (10% за блок)
- Сталактиты/сталагмиты (POINTED_DRIPSTONE)
- Лавовые озера на конце туннеля
- Атмосферные пещерные пространства

**Конфигурация**:
```yaml
cave-tunnels: true
tunnel-generation-chance: 0.03  # 3% вероятность
tunnel-min-length: 100
tunnel-max-length: 600
```

### 6. **Large Block Formations**
Случайные образования больших блоков в воздухе:

- **Высота**: 25+ блоков над землей
- **Размер**: 1-3 блока радиус
- **Материалы**:
  - BLACKSTONE
  - DEEPSLATE
  - OBSIDIAN
  - BEDROCK

**Конфигурация**:
```yaml
large-blocks: true
large-block-chance: 0.08  # 8% вероятность
large-block-height: 25  # Минимальная высота генерации
```

### 7. **Animal Watchers**
Поведение животных, которые смотрят на игроков:

- **Животные**: Свиньи (Pig), Коровы (Cow), Овцы (Sheep)
- **Механика**: Животные смотрят в сторону игрока, когда он приближается
- **Радиус обнаружения**: 20 блоков
- **Эффект**: Создает ощущение, что вас наблюдают

**Конфигурация**:
```yaml
animal-watchers: true
animal-detection-range: 20
```

## Generation Algorithm

### Поиск структур
Система проверяет области вокруг игрока каждые 2 секунды:

1. **Для домов**: Проверка каждые 50 блоков по X и Z
2. **Для пещер**: Проверка каждые 60 блоков по X и Z, на глубине y=30
3. **Для больших блоков**: Проверка каждые 80 блоков по X и Z, на высоте y=25+
4. **Для животных**: Поиск в радиусе 20 блоков каждую секунду

### Вероятности
- **Дома**: 5% (настраивается)
- **Пещеры**: 3% (настраивается)
- **Блоки**: 8% (настраивается)

### Кеш генерации
Структуры записываются в кеш, чтобы избежать дублирования:
- Одна структура не создается дважды в одном месте
- Кеш очищается при перезагрузке плагина

## Configuration Examples

### Включить все функции
```yaml
world-gen:
  constant-rain: true
  rain-worlds:
    - "world"
  haunted-houses: true
  house-generation-chance: 0.10  # Больше домов
  cave-tunnels: true
  tunnel-generation-chance: 0.05
  large-blocks: true
  large-block-chance: 0.10
  animal-watchers: true
```

### Отключить определенные функции
```yaml
world-gen:
  constant-rain: false
  haunted-houses: false
  cave-tunnels: true
  large-blocks: true
  animal-watchers: false
```

## Performance Considerations

- **Асинхронная генерация**: Все проверки выполняются асинхронно
- **Ленивая генерация**: Структуры генерируются только при необходимости
- **Кеширование**: Уже созданные структуры не создаются повторно
- **Интервал проверки**: 2 секунды (легко настраивается)

### Рекомендации
- Для серверов с большим количеством игроков уменьшите вероятности генерации
- Для серверов с мощным оборудованием можно увеличить радиус поиска
- Если ТПС падает - отключите ненужные функции

## Horror Effects Integration

Система генерации мира работает вместе с другими эффектами HorrorEngineX:

1. **Пусть игрок входит в дом** → Активируются эффекты страха
2. **Пусть игрок находит пещеру** → Мрак и неуверенность
3. **Пусть животные смотрят** → Паранойя

## Commands

```
/horrorenginex status      # Проверить статус генерации
/horrorenginex bypass      # Отключить эффекты для себя
/horrorenginex reload      # Перезагрузить конфиг
```

## Permissions

- `horrorenginex.use` - Базовое использование плагина
- `horrorenginex.bypass` - Обход эффектов страха
- `horrorenginex.admin` - Администрирование

## Technical Details

### Классы
- `WorldGenManager.java` - Главный менеджер генерации
- `HauntedHouseGenerator.java` - Генератор домов
- `CaveNetworkGenerator.java` - Генератор пещер

### Механика поиска животных
```java
playerLoc.getWorld().getNearbyEntities(playerLoc, 20, 20, 20)
  .filter(entity -> entity instanceof Pig|Cow|Sheep)
  .forEach(entity -> makeEntityLookAtPlayer(player))
```

## Future Enhancements

- [ ] Структуры в заброшенных локациях (тюрьмы, лаборатории)
- [ ] Динамическое появление/исчезновение структур
- [ ] Более реалистичная архитектура домов
- [ ] Пользовательские структуры (schematic файлы)
- [ ] Интеграция с другими плагинами (WorldEdit, etc)
