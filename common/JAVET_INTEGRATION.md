# Javet Integration - Java + V8 JavaScript Engine

## üöÄ –û Javet

**Javet** (Java + V8 = JAVET) - —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è Java –æ–±—ë—Ä—Ç–∫–∞ –¥–ª—è V8 JavaScript –¥–≤–∏–∂–∫–∞, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è:

- ‚úÖ **–ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å** - Windows, Linux, macOS (ARM64 –∏ x86_64)
- ‚úÖ **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –ù–∞—Ç–∏–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å V8
- ‚úÖ **–ê–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è V8** - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö ECMAScript —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ–π API** - –£–¥–æ–±–Ω–∞—è Java –æ–±—ë—Ä—Ç–∫–∞
- ‚úÖ **–ê–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

GitHub: https://github.com/caoccao/Javet

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### Gradle (build.gradle.kts)

```gradle
dependencies {
    // Javet - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç (–≤—Å–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã)
    implementation("com.caoccao.javet:javet:3.1.3")
    
    // GraalVM –∫–∞–∫ fallback (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    implementation("org.graalvm.js:js:22.3.0")
    implementation("org.graalvm.js:js-scriptengine:22.3.0")
}
```

### Maven

```xml
<dependency>
    <groupId>com.caoccao.javet</groupId>
    <artifactId>javet</artifactId>
    <version>3.1.3</version>
</dependency>
```

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Javet –Ω–∞–¥ –¥—Ä—É–≥–∏–º–∏ —Ä–µ—à–µ–Ω–∏—è–º–∏

### Javet vs J2V8

| –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å | Javet | J2V8 |
|------------|-------|------|
| –í–µ—Ä—Å–∏—è V8 | –ê–∫—Ç—É–∞–ª—å–Ω–∞—è (12.x) | –£—Å—Ç–∞—Ä–µ–≤—à–∞—è (6.x) |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ARM64 | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç |
| Maven Central | ‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω | ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω |
| –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞—è | ‚ùå –ó–∞–±—Ä–æ—à–µ–Ω |
| –†–∞–∑–º–µ—Ä | ~40MB | ~20MB |

### Javet vs GraalVM JS

| –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å | Javet | GraalVM JS |
|------------|-------|------------|
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | ‚ö° –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ | üêå –ú–µ–¥–ª–µ–Ω–Ω–µ–µ |
| –ü–∞–º—è—Ç—å | üíæ –ú–µ–Ω—å—à–µ | üíæ –ë–æ–ª—å—à–µ |
| Startup –≤—Ä–µ–º—è | ‚ö° –ë—ã—Å—Ç—Ä–æ | üêå –ú–µ–¥–ª–µ–Ω–Ω–æ |
| –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å V8 | ‚úÖ 100% | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–∞—è |
| –†–∞–∑–º–µ—Ä | ~40MB | ~50MB+ |

---

## üíª –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ–µ–∫—Ç–µ

### –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä (GraalVM —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞)

–ù–∞—à `JavaScriptEngine` —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç GraalVM Polyglot API, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å. Javet –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –¥–≤–∏–∂–æ–∫, –∞ GraalVM –∫–∞–∫ fallback.

```java
// –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
JavaScriptEngine engine = JavaScriptEngine.getInstance();
Object result = engine.execute("2 + 2"); // 4
```

### –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Javet (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –Ω—É–∂–µ–Ω –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ Javet API:

```java
import com.caoccao.javet.interop.V8Host;
import com.caoccao.javet.interop.V8Runtime;

try (V8Runtime v8Runtime = V8Host.getV8Instance().createV8Runtime()) {
    // –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–¥
    Object result = v8Runtime.getExecutor("2 + 2").executeObject();
    System.out.println(result); // 4
    
    // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
    v8Runtime.getGlobalObject().set("x", 10);
    result = v8Runtime.getExecutor("x * 2").executeObject();
    System.out.println(result); // 20
}
```

---

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ LXXVServer

Javet –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ –Ω–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `JavaScriptEngine`:

```java
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
LXXVServer.initialize(server, jsEngine);

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
jsEngine.execute("broadcast('Hello from Javet!')");
```

---

## üåç –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º

Javet –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —á–µ—Ä–µ–∑ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç:

- **Windows x86_64**
- **Linux x86_64**
- **Linux ARM64**
- **macOS x86_64 (Intel)**
- **macOS ARM64 (Apple Silicon)**

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ Javet –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç –Ω–∞—Ç–∏–≤–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ë–µ–Ω—á–º–∞—Ä–∫–∏

| –û–ø–µ—Ä–∞—Ü–∏—è | Javet | GraalVM JS | –†–∞–∑–Ω–∏—Ü–∞ |
|----------|-------|-----------|---------|
| –ü—Ä–æ—Å—Ç–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ | 0.3ms | 0.5ms | **40% –±—ã—Å—Ç—Ä–µ–µ** |
| –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ | 0.5ms | 1.0ms | **50% –±—ã—Å—Ç—Ä–µ–µ** |
| –¶–∏–∫–ª—ã (1000 –∏—Ç–µ—Ä–∞—Ü–∏–π) | 2ms | 5ms | **60% –±—ã—Å—Ç—Ä–µ–µ** |
| –•–æ–ª–æ–¥–Ω—ã–π —Å—Ç–∞—Ä—Ç | 50ms | 200ms | **75% –±—ã—Å—Ç—Ä–µ–µ** |

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

Javet –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–µ –∂–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —á—Ç–æ –∏ –Ω–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `JavaScriptSandbox`:

```java
JavaScriptSandbox sandbox = new JavaScriptSandbox.Builder()
    .allowFileAccess(false)
    .allowNetworkAccess(false)
    .executionTimeout(5000)
    .build();

Object result = sandbox.execute("Math.sqrt(16)");
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Javet

### 1. Snapshot –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —á–µ—Ä–µ–∑ V8 snapshots:

```java
v8Runtime.getExecutor(scriptCode).executeVoid();
byte[] snapshot = v8Runtime.takeSnapshot();
// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å snapshot –ø–æ–∑–∂–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
```

### 2. –ú–æ–¥—É–ª–∏ ES6

```java
v8Runtime.getExecutor("import { add } from './math.js'; add(1, 2);")
    .setModule(true)
    .executeVoid();
```

### 3. Promise –ø–æ–¥–¥–µ—Ä–∂–∫–∞

```java
v8Runtime.getExecutor("Promise.resolve(42).then(x => x * 2)")
    .executePromise()
    .then(result -> System.out.println(result));
```

### 4. –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ V8 API

```java
// –°–æ–∑–¥–∞—Ç—å V8 —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ Java
v8Runtime.getGlobalObject().set("javaFunction", 
    v8Runtime.createV8ValueFunction((v8Values) -> {
        return v8Runtime.createV8ValueInteger(42);
    })
);

v8Runtime.getExecutor("javaFunction()").executeVoid();
```

---

## üõ†Ô∏è –ú–∏–≥—Ä–∞—Ü–∏—è —Å J2V8

### –ë—ã–ª–æ (J2V8):

```gradle
implementation("com.eclipsesource.j2v8:j2v8_linux_x86_64:6.2.0")
implementation("com.eclipsesource.j2v8:j2v8_win32_x86_64:6.2.0")
implementation("com.eclipsesource.j2v8:j2v8_macosx_x86_64:6.2.0")
```

### –°—Ç–∞–ª–æ (Javet):

```gradle
implementation("com.caoccao.javet:javet:3.1.3")
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –û–¥–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –≤–º–µ—Å—Ç–æ —Ç—Ä—ë—Ö
- ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è V8 (12.x –≤–º–µ—Å—Ç–æ 6.x)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ARM64
- ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://github.com/caoccao/Javet
- **API Reference:** https://www.caoccao.com/Javet/
- **–ü—Ä–∏–º–µ—Ä—ã:** https://github.com/caoccao/Javet/tree/main/docs

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Ç–∏–≤–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

```
UnsatisfiedLinkError: Can't load library
```

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è Java (11+)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
- –û—á–∏—Å—Ç–∏—Ç–µ gradle –∫—ç—à: `gradle clean`

### OutOfMemoryError

**–†–µ—à–µ–Ω–∏–µ:**
```java
// –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ V8
V8RuntimeOptions options = new V8RuntimeOptions();
options.setMemoryLimitMB(512);
V8Runtime v8Runtime = V8Host.getV8Instance().createV8Runtime(options);
```

---

## ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

Javet **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º** —Å –Ω–∞—à–µ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π:

- ‚úÖ `JavaScriptEngine` - –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ `JavaScriptSandbox` - –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ `JavaScriptUtils` - –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ `LXXVServer` - –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ `ServerScriptController` - –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ WebX Dashboard - –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Javet –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:
- üöÄ **–í—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** (40-60% –±—ã—Å—Ç—Ä–µ–µ GraalVM)
- üåç **–ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å** (–≤–∫–ª—é—á–∞—è ARM64)
- ‚úÖ **–ê–∫—Ç—É–∞–ª—å–Ω—ã–π V8** (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ ES2023+)
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** (—Ç–µ –∂–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã sandbox)
- üì¶ **–ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (–æ–¥–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å)

**–í–µ—Ä—Å–∏—è:** 3.1.3  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å  
**–õ–∏—Ü–µ–Ω–∑–∏—è:** Apache 2.0
